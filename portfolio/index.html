<!DOCTYPE html>
<html lang="en">
<head>
	<!--<meta charset="utf-8"/>-->
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="format-detection" content="telephone=no">
	<!--<script type="text/javascript" src="/function.js"></script>-->
	<link rel="preload" as="style" type="text/css" media="all" href="/fonts/equity-heavy.css">
	<link rel="stylesheet" type="text/css" media="all" href="/fonts/equity-heavy.css">
	<title>ME460 Portfolio</title>
	<!-- <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/4.2.0/normalize.css"> -->
    <!--<script src="https://cdn.jsdelivr.net/gh/google/code-prettify@master/loader/run_prettify.js"></script>-->
	<link rel="stylesheet" type="text/css" href="css/index.css">
	<style type="text/css">
		body.hidden { opacity: 0; }
        .prettyprint { 
            display: block; 
            background-color: #eee
            font-family: monospace;
            font-size: 12px;
            border: 1px solid #eee;
            padding: 15px;
            white-space: pre-wrap;       /* Since CSS 2.1 */
            white-space: -moz-pre-wrap;  /* Mozilla, since 1999 */
            white-space: -pre-wrap;      /* Opera 4-6 */
            white-space: -o-pre-wrap;    /* Opera 7 */
            word-wrap: break-word;       /* Internet Explorer 5.5+ */
        }
        pre code {
            background-color: #eee
        }
        /*ol.linenums { margin-top: 0; margin-bottom: 0 }
        li {background: #eee;}*/
</style><!--
/*
* Derived from einaros's Sons of Obsidian theme at
* http://studiostyl.es/schemes/son-of-obsidian by
* Alex Ford of CodeTunnel:
* http://CodeTunnel.com/blog/post/71/google-code-prettify-obsidian-theme
*/
.str{color: #EC7600;}
.kwd{color: #93C763;}
.com{color: #66747B;}
.typ{color: #678CB1;}
.lit{color: #FACD22;}
.pun{color: #F1F2F3;}
.pln{color: #F1F2F3;}
.tag{color: #8AC763;}
.atn{color: #E0E2E4;}
.atv{color: #EC7600;}
.dec{color: purple;}

/* Specify class=linenums on a pre to get line numbering */
ol.linenums { margin-top: 0; margin-bottom: 0; color: #eee } /* IE indents via margin-left */
li.L0,li.L1,li.L2,li.L3,li.L5,li.L6,li.L7,li.L8 { list-style-type: none }
/* Alternate shading for lines */
li.L1,li.L3,li.L5,li.L7,li.L9 { }
/*pre.prettyprint{border: 0px solid #888;}
ol.linenums{
    margin-top: 0;
    margin-bottom: 0;
}
li.L0, li.L1, li.L2, li.L3, li.L4, li.L5, li.L6, li.L7, li.L8, li.L9
{
    color: #555;
    list-style-type: decimal;
}
li.L1, li.L3, li.L5, li.L7, li.L9 {
    background: #111;
}*/
@media print{
    .str{color: #060;}
    .kwd{color: #006; font-weight: bold;}
    .com{color: #600; font-style: italic;}
    .typ{color: #404; font-weight: bold;}
    .lit{color: #044;}
    .pun{color: #440;}
    .pln{color: #000;}
    .tag{color: #006; font-weight: bold;}
    .atn{color: #404;}
    .atv{color: #060;}
}
.prettyprint {
    /*font-family: monospace;*/
    font-size: 12px;
    /*background-color: #eee;
    border: 1px solid #999;
    display: block;*/
    padding: 20px;
    white-space: pre-wrap;       /* Since CSS 2.1 */
    white-space: -moz-pre-wrap;  /* Mozilla, since 1999 */
    white-space: -pre-wrap;      /* Opera 4-6 */
    white-space: -o-pre-wrap;    /* Opera 7 */
    word-wrap: break-word;       /* Internet Explorer 5.5+ */
}
	</style>-->
	<!--Favicons-->
	<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
	<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
	<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
	<link rel="manifest" href="/site.webmanifest">
	<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
	<meta name="msapplication-TileColor" content="#da532c">
	<meta name="theme-color" content="#ffffff">
</head>
<body id="body" class="body-text_equity" body-text="true">
<div id="content">
	<div id="doc">
		<topic class="small">Linear Drive Code and Data (Intermediate Deliverables)</topic>
		<p>Below are the intermediate deliverables for <i>Design Project #1</i> of ME460, this page will be updated with a full writeup for the Wednesday deliverables.        
        </p>
        <div class="subhead small-caps" id="code">
            <a href="#code">code</a>
        </div>
        <pre class="prettyprint lang-c"><code>#define OFF   0
#define NORTH 1
#define SOUTH 2

// globals
int s_delay=5000;     // step delay in micros

void setup() {
  // coil A
  pinMode(12,OUTPUT); // direction
  pinMode(3,OUTPUT);  // on/off
  pinMode(9,OUTPUT);  // brake

  // coil B
  pinMode(13,OUTPUT);
  pinMode(11,OUTPUT);
  pinMode(8,OUTPUT);

  shutdown();

  Serial.begin(115200);
}

void loop() {
  // init step and time counters
  int step;
  double t0 = micros();
  
  // 50 steps per 1 revolution
  for (step=0;step<=300;step++) {  
    towards();
    readout(t0,step);
  }
  
  for (step=0;step<=300;step++) {
    away();
    readout(t0,step);
  }
  
  shutdown(); // turn off all
  while(1);   // hold until reset
}

// away from stepper
void away() {
  coilA(NORTH);
  coilB(OFF);
  delayMicroseconds(s_delay);
  coilA(OFF);
  coilB(NORTH);
  delayMicroseconds(s_delay);
  coilA(SOUTH);
  coilB(OFF);
  delayMicroseconds(s_delay);
  coilA(OFF);
  coilB(SOUTH);
  delayMicroseconds(s_delay);
  coilA(NORTH);
  coilB(OFF);
  delayMicroseconds(s_delay);
}

// towards stepper
void towards() {
  coilA(OFF);
  coilB(NORTH);
  delayMicroseconds(s_delay);
  coilA(NORTH);
  coilB(OFF);
  delayMicroseconds(s_delay);
  coilA(OFF);
  coilB(SOUTH);
  delayMicroseconds(s_delay);
  coilA(SOUTH);
  coilB(OFF);
  delayMicroseconds(s_delay);
  coilA(OFF);
  coilB(NORTH);
  delayMicroseconds(s_delay);
}

void coilA(int polarity) {
  digitalWrite(9,LOW);
  if (polarity == NORTH) {
    digitalWrite(12,HIGH);
    digitalWrite(3,HIGH);
  }
  if (polarity == SOUTH) {
    digitalWrite(12,LOW);
    digitalWrite(3,HIGH);
  }
  if (polarity == OFF) {
    digitalWrite(12,LOW);
    digitalWrite(3,LOW);
  }
}

void coilB(int polarity) {
  digitalWrite(8,LOW);
  if (polarity == NORTH) {
    digitalWrite(13,HIGH);
    digitalWrite(11,HIGH);
  }
  if (polarity == SOUTH) {
    digitalWrite(13,LOW);
    digitalWrite(11,HIGH);
  }
  if (polarity == OFF) {
    digitalWrite(13,LOW);
    digitalWrite(11,LOW);
  }
}

// measures current in A & B
// prints time, step #, and current
void readout(double t0, int step) {
  float i_A = float(analogRead(0)) / 1023.0 * 5.0 / 1.65 * 1000.0,
        i_B = float(analogRead(1)) / 1023.0 * 5.0 / 1.65 * 1000.0;
  Serial.println(
    String((micros()-t0)/1000000)
    +"\t"
    +String(step*4)
    +"\t"
    +String(i_A)
    +"\t"
    +String(i_B)
  );
}

// turn all off
void shutdown() {
  digitalWrite (12,LOW);
  digitalWrite (3,LOW);
  digitalWrite (9,LOW);
  digitalWrite (13,LOW);
  digitalWrite (11,LOW);
  digitalWrite (8,LOW);
}</code></pre>
		<div class="subhead small-caps" id="data">
			<a href="#data">data</a>
		</div>
	</div>
</div>
</body>
</html>
<!-- 2020 Zachary Weiss -->